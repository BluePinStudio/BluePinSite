<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta content="ie=edge" http-equiv="x-ua-compatible">
    <meta content="width=device-width, initial-scale=1" name="viewport">

    {% include framework/seo-meta-tags.html %}
    {% include framework/og-meta-tags.html %}
    {% include framework/feed.html %}
    {% include framework/favicon.html %}
    
    <link rel="stylesheet" href="{{ '/assets/css/snow.css' | relative_url }}">
    <link href="{{ '/assets/css/main.css' | relative_url }}" rel="stylesheet">

    <!-- Force dark mode always -->
    <script>
      document.documentElement.setAttribute('data-bs-theme', 'dark');
    </script>

    {% if site.cookie_banner.enabled %}
      {% include framework/cookie-consent.html %}
    {% endif %}

    {% include framework/fonts.html %}
    {% include framework/google-tag-manager.html %}

  </head>
<body class="page {% if page.body_classes %}{{ page.body_classes }}{% elsif layout.body_classes %}{{ layout.body_classes }}{% endif %}{% if site.header.fixed %} has-fixed-header{% else %} has-static-header{% endif %}">

{% include framework/menu-main-mobile.html %}
{% include framework/header.html %}

<div id="wrapper" class="wrapper">     
  {{ content }}
</div>

{% if site.footer.enable_footer %}
  {% include framework/footer.html %}
{% endif %}
{% if site.bottom.enable_bottom %}
  {% include framework/bottom.html %}
{% endif %}

<script type="text/javascript" src="{{ '/assets/js/scripts.js' | relative_url }}"></script>
<script src="{{ '/assets/js/snow.js' | relative_url }}"></script>
{% if site.header.fixed %}
  <script type="text/javascript" src="{{ '/assets/js/header.js' | relative_url }}"></script>
{% endif %}
<script type="text/javascript" src="{{ '/assets/js/hamburger.js' | relative_url }}"></script>
<!-- darkModeSwitch.js no longer needed for static dark mode, but kept for safety -->
<script type="text/javascript" src="{{ '/assets/js/darkModeSwitch.js' | relative_url }}"></script>

{% include framework/google-analytics.html %}
{% include framework/plausible-analytics.html %}
{% include framework/umami-analytics.html %}

<img id="follower-gif" src="{{ '/assets/images/Vinny_Small.gif' | relative_url }}" alt="Vinny" />

<script>
document.addEventListener('DOMContentLoaded', function () {
  const STORAGE_KEY = 'followerEnabled';
  const follower = document.getElementById('follower-gif');
  const toggle = document.getElementById('toggleFollower');
  if (!follower || !toggle) return;

  // Hide on mobile/touch
  if ('ontouchstart' in window || navigator.maxTouchPoints > 0) {
    follower.style.display = 'none';
    toggle.style.display = 'none';
    return;
  }

  // Default: ON, unless first visit with reduced motion preference
  const prefersReduced = window.matchMedia?.('(prefers-reduced-motion: reduce)')?.matches;
  const stored = localStorage.getItem(STORAGE_KEY);
  let enabled = stored === null ? !prefersReduced : stored === '1';

  function applyState() {
    toggle.classList.toggle('active', enabled);
    follower.style.display = enabled ? 'block' : 'none';
  }
  applyState();

  toggle.addEventListener('click', () => {
    enabled = !enabled;
    localStorage.setItem(STORAGE_KEY, enabled ? '1' : '0');
    applyState();
  });

  let mouseX = 0, mouseY = 0, currentX = 0, currentY = 0;

  document.addEventListener('mousemove', (e) => {
    if (!enabled) return;
    mouseX = e.clientX;
    mouseY = e.clientY;
  });

  function animate() {
    const speed = 0.02;
    currentX += (mouseX - currentX) * speed;
    currentY += (mouseY - currentY) * speed;
    if (enabled) {
      follower.style.transform = `translate(-50%, 0%) translate(${currentX}px, ${currentY}px)`;
    }
    requestAnimationFrame(animate);
  }

  animate();
});
</script>

<noscript>
  <style>
    #follower-gif {
      display: none !important;
    }
  </style>
</noscript>

</body>
</html>
